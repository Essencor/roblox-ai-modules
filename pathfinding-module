-- SUPER SIMPLE PATHFINDING MODULE
-- No fancy features, just basic navigation

local PathfindingService = game:GetService("PathfindingService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local PathfindingModule = {}

local isNavigating = false

function PathfindingModule.Navigate(target, mode)
    print("[Pathfinding] Starting navigation...")
    
    local character = LocalPlayer.Character
    if not character then
        warn("[Pathfinding] No character found")
        return false
    end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    
    if not humanoid or not rootPart then
        warn("[Pathfinding] Missing humanoid or root part")
        return false
    end
    
    -- Get target position
    local targetPos
    if typeof(target) == "Vector3" then
        targetPos = target
    elseif typeof(target) == "Instance" then
        if target:IsA("BasePart") then
            targetPos = target.Position
        elseif target:IsA("Model") then
            local primaryPart = target.PrimaryPart or target:FindFirstChildWhichIsA("BasePart")
            if primaryPart then
                targetPos = primaryPart.Position
            end
        end
    end
    
    if not targetPos then
        warn("[Pathfinding] Could not get target position")
        return false
    end
    
    print("[Pathfinding] Target position:", targetPos)
    
    isNavigating = true
    
    -- Create path
    local path = PathfindingService:CreatePath({
        AgentRadius = 2,
        AgentHeight = 5,
        AgentCanJump = true,
        AgentCanClimb = false,
        WaypointSpacing = 4
    })
    
    -- Compute path
    local success, errorMsg = pcall(function()
        path:ComputeAsync(rootPart.Position, targetPos)
    end)
    
    if not success then
        warn("[Pathfinding] Path computation failed:", errorMsg)
        isNavigating = false
        return false
    end
    
    if path.Status ~= Enum.PathStatus.Success then
        warn("[Pathfinding] Path status:", path.Status)
        isNavigating = false
        return false
    end
    
    local waypoints = path:GetWaypoints()
    
    if not waypoints or #waypoints == 0 then
        warn("[Pathfinding] No waypoints generated")
        isNavigating = false
        return false
    end
    
    print("[Pathfinding] Following", #waypoints, "waypoints")
    
    -- Follow waypoints
    for i, waypoint in ipairs(waypoints) do
        if not isNavigating then
            print("[Pathfinding] Navigation cancelled")
            return false
        end
        
        if waypoint.Action == Enum.PathWaypointAction.Jump then
            humanoid.Jump = true
        end
        
        humanoid:MoveTo(waypoint.Position)
        
        -- Wait for movement
        local timeout = 8
        local startTime = tick()
        
        repeat
            task.wait(0.1)
            if not isNavigating then
                return false
            end
        until (rootPart.Position - waypoint.Position).Magnitude < 5 or (tick() - startTime) > timeout
    end
    
    isNavigating = false
    print("[Pathfinding] Navigation complete!")
    return true
end

function PathfindingModule.Stop()
    print("[Pathfinding] Stopping navigation")
    isNavigating = false
    
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoid and rootPart then
            humanoid:MoveTo(rootPart.Position)
        end
    end
end

function PathfindingModule.GetStatus()
    return {
        isNavigating = isNavigating,
        currentWaypoint = 0,
        totalWaypoints = 0,
        mode = "basic",
        stuckCount = 0,
        deathZones = 0,
        stats = {
            totalPaths = 0,
            successfulPaths = 0,
            failedPaths = 0,
            jumpsExecuted = 0,
            stucksRecovered = 0,
            deathsLearned = 0
        }
    }
end

function PathfindingModule.ClearLearning()
    print("[Pathfinding] ClearLearning called (no-op in simple version)")
end

print("[Pathfinding] Simple module loaded successfully!")

return PathfindingModule
